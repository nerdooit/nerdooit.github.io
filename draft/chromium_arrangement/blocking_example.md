## Blocking / Non Blocking / Synchronous / Asynchronous
위의 주제에 대해 다뤄보고자 한다. 평소에 많이 전달받아 익숙한 단어들이지만,
	실제로 어떻게 구별하는지 어떤 방식에서 차이가 있는지에 대해 잘 알지 못해
	정리를 해보고자 한다.

이해를 돕기 위해, 위의 동작들을 일상생활의 예시를 통해 먼저 정리해보자. 커피점의
홍보비는 따로 받지 않았다;;

우리는 coffee를 마시기 위해 스타x스에 방문한다. 이 스타x스 에서도 blocking을
비롯한 synchoronous 동작들을 확인할 수 있다. 우리가 스타x스에서 할 수 있는 일을
적어보자.

1. 스타벅스 문을 열고 들어가서 인사한다.
2. 커피를 주문한다.
3. 커피 만드는 것을 기다린다.
4. 커피 받는다.
5. 커피 마신다.

위 동작을 조금 세분화 해서 보자.

1. 스타벅스 문을 열고 들어가서 인사한다.
2. 커피를 주문한다.
	- 대면 방식으로 주문 후 바로 준비해드릴게요 - synchronous (blocking도 포함,
			하지만 배제하고 이야기함.)
	- 비대면 방식 (사이랜 오더)로 주문 후 알람이 울리면 커피를 가지러 간다. -
	asynchronous (non-blocking도 포함, 하지만 배제하고 이야기함.)
3. 커피 만드는 것을 기다린다.
	- 커피를 만드는 과정에서 문제가 생길 경우 손님에게 이야기한다. (e.g. 우유나 휘핑이 떨어짐) - non-blocking
	- 커피를 만드는 과정에서 문제가 생길 경우 그냥 처리한다. - blocking
4. 커피 받는다.
5. 커피 마신다.

위의 설명을 보고 이해가 안될 수도 있다. 아래의 설명을 통해 자세하게 설명을 한 후
왜 스타x스에서 발생하는 일이 위와 같이 동작하는지 알아보자.

들어가기전, 아래의 그림을 이해하자.

![routine](/img/routine.png)

하나의 함수의 실행과정을 나타낸 것이다. 실모양은 thread라고 부르며, 하나의
thread가 함수 루틴을 끝낸 그림을 나타낸다.

---

### Synchronous / Asynchronous
아래의 동작에 대해 알아보기 전에, 문자의 어원을 보자. Synchronous는 Syn + chronous 이렇게 나눠져있다. ous 같은 경우 형용사형으로 품사를 변경한다 치고 크게
영향을 미치지 않는다. 중요한 것은 syn + chron이다. syn의 뜻은 ***together***를 뜻한다. chrono는 c++ 헤더 파일에도 존재하 듯, 시간을 의미한다. Synchronous는 ***함께 시간을 마추는*** 정도로 이해할 수 있다. 즉, 함께 시간을 맞춰 동작하는 이라고 프로그래밍 입장에서는 이해할 수 있다. A+Synchronous는 A라는 부정 즉, (!)의 의미를 갖고 있으므로 ***함께 시간을 마추지 않는*** 정도로 해석할 수 있다.

Synchronous (이하 sync) / Asynchronous (이하 async)는 어원에서 볼 수 있듯,
						***시간*** 확인하는 것이 중요하다. 프로그래밍 입장에서 생각해보자면,
						***어떤 대상*** 이 실행하는 것도 중요하다. "시간, 대상" 두 가지를
						중점에 두고 이야기 해보자.

#### Synchronous
Sync는 두 가지 이상의  루틴(function, thread 등)이 서로 시간을 맞춰 동작하는 것을
말한다. 시간에 초점을 맞추고 보는 것이 중요하다. 루틴을 수행하는 대상이 루틴들의
입력 / 출력 시간을 알고 있을 경우를 "Synchronous 하다" 라고 한다. 예를 들면,
Lock을 생각해보자. 하나의 구간에 두개의 루틴(thread) 가 ***동시에*** 수행할 경우
Synchornous하게 처리하는 기법이 있다. 다른 예시는 아래의 그림을 보자.

![sync](/img/sync.png)

루틴을 처리하는 대상에서 두 가지의 루틴에 대해 언제 시작하고 언제 끝나는지 알고
있으며, 이를 연속적으로 처리하기 위해 A루틴 이후 B루틴을 시작하게 한다 라는
방식으로 수행하는 것은 "Synchronous 하다" 라고 한다.

자, 이제 스타x스 예시로 돌아와 생각해보자. 우리가 대면으로 샌드위치를
주문한다면, 직원은 "바로 준비해드리겠습니다" 라고 한다. 이 경우 우리는 주문
(시작)시간과 바로 준비 (끝) 시간을 알기 때문에 받은 후 올라가서 자리를 잡아야지
라고 이후 루틴을 세울 수 있다. 이를 ***Synchronous 하다*** 라고 한다.

#### Asynchronous
Async 같은 경우 sync의 반대라는 것은 너무 자명하다. 즉, 서로 시간을 맞춰서
동작하지 않는 것을 의미하며, 루틴들의 시작 / 끝 시간을 알지 못하는 경우를
말한다.

![Async](/img/async.png)

루틴을 수행하는 대상에서 모든 루틴의 시작과 끝을 알 수 없는 경우가 존재한다. 위
그림과 같이, 하나의 대상에서 두 개의 루틴을 모두 관리하지 않고 B 루틴을 다른
대상에게 맡길 경우 B루틴이 언제 종료되는지 알 수 없다. B루틴이 종료된 후
***시그널, 콜백루틴*** 을 전달해야 A 루틴을 수행하는 ProcessA는 B루틴이
종료되었구나 를 알 수 있다. 이런 상황을 ***Asynchronous 하다*** 라고 한다. 

자, 스타x스 에서는 Async가 어떤 예시일까?

비대면 방식으로 주문하게 된다면, 사이랜오더라는 것을 이용해 카운터에 주문을 할
것이다. 주문한 후 사용자는 전적으로 커피 만드는 것, 완료된 것등을 스타벅스
직원에게 맡기고 신경 쓰지 않는다. 이후 스타x스 직원이 완료되었다고 호출(시그널,
		콜백)을 주면 아 완료되었구나 하고 커피를 가지러 간다던지, 가서 마신다던지?,
	혹은 무시한다던지 등의 후속처리를 한다. 이런 상황을 ***Asynchronous 하다***
	라고 하며, 루틴을 수행하는 대상이 루틴의 시작 / 끝을 알 수 없을 경우를 말한다. 

Sync, Async 같은 경우 둘 만의 장단점이 존재한다. 적절하게 사용하는 것이
중요하다.

### Blocking / Non-Blocking
Blocking(이하 블로킹) / Non-Blocking (이하 논블로킹)은 Sync / Async 동작과
구분이 되지 않고 같다고 생각하는 사람들이 많이 있다. (본인도 여기에 포함된다.)
	이는 잘못된 개념이며, 서로 관점이 다르다는 것을 기억해야한다. 블로킹 /
	논블로킹은 ***직접 제어할 수 없는 대상에 대한 처리*** 를 말한다. 직접 제어할
	수 없는 대표적인 모델은 OS이다. OS 기법 중 IO 동작에서 많이 사용한다. (IO 같은
			경우 속도차가 극명하게 나뉘기 때문에 위의 동작이 적절하게 사용됨.)

직접제어 하지 못하는 영역을 처리할 때, 두가지 방식이 존재한다.
- 기다린다 => Blocking
- 기다리지 않는다 => Non-Blocking

#### Blocking
Blocking 직접 제어할 수 없는 대상에 대해 ***기다리는 경우***를 말한다. 대표적인
예제로 OS의 IO동작을 떠올릴 수 있다. IO 같은 경우 cpu에서 필요한 데이터를 memory
/ HDD 를 통해 읽어 오거나 쓰는 동작을 말한다. 만약 cpu에서 데이터가 필요해
read연산을 수행할 경우 데이터를 읽어오는 동작을 수행하는데, 데이터를 읽어오는
동안 cpu는 기다리는 경우가 많다. 이를 블로킹 된다라고 한다.

자, 블로킹의 스타x스 예시를 생각해보자.

커피를 주문하게 된다면, 스타x스 직원에게 모든 제어권은 넘어간다. 만약 스타x스의
직원이 커피를 만드는 중 우유를 비롯한 재료 중 하나가 부족하다는 것을 알게 된다.
그 경우 바로 옆 스타벅스 창고에서 재료를 가져와 작업을 해야하는데, 뛰어가서 작업
후 손님에게 커피를 제공한다. 즉, 제어권이 넘어간 이후 손님은 커피를 만드는
과정에서 어떤일이 일어나도 무한정 블로킹 되는 것이다. "제어권이 넘어간
상황에서 기다린다" 라는 점에 주목해야한다.

#### Non-blocing
Non-blocking같은 경우 blocking 동작의 반대되는 개념으로 무한정 기다리지 않는
것을 말한다. 즉, 직접 제어할 수 없는 대상에 대해서는 신경 쓰지 않겠다는 것을
의미한다.




---
### Reference
- [개발 이야기](https://velog.io/@codemcd/Sync-VS-Async-Blocking-VS-Non-Blocking-sak6d01fhx)
- [컨텍스트 스위치](https://jins-dev.tistory.com/entry/%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%8A%A4%EC%9C%84%EC%B9%98Context-Switching-%EC%97%90-%EB%8C%80%ED%95%9C-%EC%A0%95%EB%A6%AC)
- [김짱쌤](https://ozt88.tistory.com/20?category=123069)
-[AIO 정리](https://www.joinc.co.kr/w/Site/Network_Programing/AdvancedComm/AIO)

-[정리2](https://victorydntmd.tistory.com/8)
-[소켓 서버 개념](https://velog.io/@jyongk/TCP-Socket-Blocking-Non-Blocking)
